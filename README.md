# Sistema de Gerenciamento de Usu√°rios

Um sistema full-stack de gerenciamento de usu√°rios com frontend React e backend NestJS, conectados via axios para opera√ß√µes CRUD.

## Funcionalidades

-   ‚úÖ Opera√ß√µes Create, Read, Update, Delete (CRUD) para usu√°rios
-   ‚úÖ Sincroniza√ß√£o de dados em tempo real entre frontend e backend
-   ‚úÖ Valida√ß√£o de formul√°rios e tratamento de erros
-   ‚úÖ Funcionalidade de busca e filtro
-   ‚úÖ Design responsivo com Tailwind CSS
-   ‚úÖ Notifica√ß√µes toast para feedback do usu√°rio
-   ‚úÖ Banco de dados PostgreSQL com Prisma ORM
-   ‚úÖ Testes automatizados com Jest (Backend)
-   ‚úÖ Documenta√ß√£o interativa da API com Swagger

## üöÄ Extras Implementados

-   üìö Documenta√ß√£o dos Endpoints com Swagger
-   üß™ Testes Automatizados com Jest

## Stack Tecnol√≥gica

### Frontend

-   React 19 com TypeScript
-   Vite para ferramentas de build
-   Tailwind CSS para estiliza√ß√£o
-   Axios para comunica√ß√£o com API
-   React Hook Form para manipula√ß√£o de formul√°rios
-   Headless UI para componentes acess√≠veis

### Backend

-   NestJS com TypeScript
-   Prisma ORM
-   Banco de dados PostgreSQL
-   Class-validator para valida√ß√£o de DTO
-   CORS habilitado para comunica√ß√£o com frontend
-   Jest para testes automatizados
-   Swagger para documenta√ß√£o da API

## Como Come√ßar

### Pr√©-requisitos

-   Node.js (v18 ou superior)
-   Docker e Docker Compose
-   Yarn ou npm

### Inicializa√ß√£o R√°pida (Script)

Para facilitar o processo, voc√™ pode usar o script de inicializa√ß√£o:

```bash
# Certifique-se de estar no diret√≥rio raiz do projeto
./start-dev.sh
```

Este script ir√°:

-   Verificar se voc√™ est√° no diret√≥rio correto
-   **Criar automaticamente os arquivos .env necess√°rios**
-   Iniciar o PostgreSQL
-   Aguardar o PostgreSQL estar pronto
-   **Executar as migrations do banco de dados automaticamente**
-   Fornecer instru√ß√µes para iniciar backend e frontend

**üí° Dica:** O script agora cria automaticamente os arquivos `.env` e executa as migrations do Prisma, ent√£o a tabela `User` ser√° criada automaticamente no banco de dados.

### Configura√ß√£o Manual de Vari√°veis de Ambiente (Opcional)

Se preferir configurar manualmente, voc√™ pode criar os arquivos `.env`:

#### Backend (.env)

Crie o arquivo `backend/.env` com o seguinte conte√∫do:

```env
# Database connection string for PostgreSQL
DATABASE_URL="postgresql://user:password@localhost:5432/db"
```

#### Frontend (.env)

Crie o arquivo `frontend/.env` com o seguinte conte√∫do:

```env
# API URL for backend communication
VITE_API_URL=http://localhost:3001
```

**‚ö†Ô∏è Importante:**

-   Certifique-se de que a URL da API no frontend (`VITE_API_URL`) corresponda √† porta onde o backend est√° rodando (3001)
-   O arquivo `.env` deve ser criado antes de executar `yarn start:dev` ou `yarn dev`
-   O backend usa `@nestjs/config` para carregar as vari√°veis de ambiente automaticamente

### Executando a Aplica√ß√£o

1. **Iniciar Banco de Dados PostgreSQL:**

    ```bash
    # Certifique-se de estar no diret√≥rio raiz do projeto
    # ‚ö†Ô∏è IMPORTANTE: Certifique-se de que o Docker Desktop est√° rodando antes de executar este comando
    # Iniciar PostgreSQL no Docker
    docker-compose up postgres -d
    ```

2. **Iniciar Backend (Terminal 1):**

    ```bash
    # Abra uma NOVA janela de terminal
    # Navegue at√© o diret√≥rio backend
    cd backend/

    # Instale as depend√™ncias (se ainda n√£o foi feito)
    yarn install

    # Inicie o backend
    yarn start:dev
    ```

    **‚ö†Ô∏è Importante:** Certifique-se de estar no diret√≥rio `backend/` antes de executar os comandos.

    **Aguarde at√© ver:**

    ```
    üöÄ Application is running on: http://localhost:3001
    üìö Swagger documentation available at: http://localhost:3001/api
    ```

3. **Iniciar Frontend (Terminal 2):**

    ```bash
    # Abra OUTRA NOVA janela de terminal
    # Navegue at√© o diret√≥rio frontend
    cd frontend/

    # Instale as depend√™ncias (se ainda n√£o foi feito)
    yarn install

    # Inicie o frontend
    yarn dev
    ```

    **‚ö†Ô∏è Importante:** Certifique-se de estar no diret√≥rio `frontend/` antes de executar os comandos.

    **Aguarde at√© ver:**

    ```
    VITE v7.0.5  ready in 2251 ms
    ‚ûú  Local:   http://localhost:5173/
    ```

4. **Acessar a Aplica√ß√£o:**
    - Frontend: http://localhost:5173
    - Backend API: http://localhost:3001
    - Verifica√ß√£o de sa√∫de: http://localhost:3001/health
    - **Documenta√ß√£o Swagger**: http://localhost:3001/api

### Migrations do Banco de Dados

O projeto usa Prisma ORM para gerenciar o banco de dados. As migrations s√£o executadas automaticamente pelo script `start-dev.sh`, mas voc√™ tamb√©m pode execut√°-las manualmente:

```bash
# Navegue at√© o diret√≥rio backend
cd backend/

# Gerar o cliente Prisma
yarn prisma:generate

# Executar migrations existentes
yarn prisma:migrate

# Ou executar tudo de uma vez (gerar cliente + migrations)
yarn db:setup
```

**üìù Comandos √∫teis do Prisma:**

```bash
# Criar uma nova migration (desenvolvimento)
yarn prisma:migrate:dev

# Visualizar o banco de dados no Prisma Studio
npx prisma studio

# Resetar o banco de dados (‚ö†Ô∏è CUIDADO: apaga todos os dados)
npx prisma migrate reset
```

**üí° Dica:** Se voc√™ precisar criar novas migrations, use `yarn prisma:migrate:dev` durante o desenvolvimento. Para produ√ß√£o, use `yarn prisma:migrate`.

### Endpoints da API

O backend fornece os seguintes endpoints REST:

-   `GET /users` - Obter todos os usu√°rios
-   `GET /users/:id` - Obter um usu√°rio espec√≠fico
-   `POST /users` - Criar um novo usu√°rio
-   `PATCH /users/:id` - Atualizar um usu√°rio existente
-   `DELETE /users/:id` - Deletar um usu√°rio

## üìö Documenta√ß√£o da API com Swagger

O projeto inclui documenta√ß√£o interativa da API usando Swagger. Ap√≥s iniciar o backend, voc√™ pode acessar:

### URLs de Acesso

-   **Swagger UI**: http://localhost:3001/api
-   **OpenAPI JSON**: http://localhost:3001/api-json

### Como Testar a API no Swagger

#### 1. Acessar a Interface Swagger

1. Certifique-se de que o backend est√° rodando:

    ```bash
    cd backend
    yarn start:dev
    ```

2. Abra seu navegador e acesse:
    ```
    http://localhost:3001/api
    ```

#### 2. Testar Endpoints no Swagger

##### Criar Usu√°rio (POST /users)

1. Clique em **"Users"** ‚Üí **"POST /users"**
2. Clique em **"Try it out"**
3. Preencha o JSON de exemplo:
    ```json
    {
        "name": "Jo√£o Silva",
        "gender": "male",
        "email": "joao.silva@email.com",
        "birthDate": "1990-05-15",
        "placeOfBirth": "S√£o Paulo, SP",
        "nationality": "Brasileira",
        "cpf": "12345678901"
    }
    ```
4. Clique em **"Execute"**

##### Listar Usu√°rios (GET /users)

1. Clique em **"GET /users"**
2. Clique em **"Try it out"**
3. Clique em **"Execute"**

##### Buscar por ID (GET /users/{id})

1. Clique em **"GET /users/{id}"**
2. Clique em **"Try it out"**
3. Digite o ID do usu√°rio (ex: `1`)
4. Clique em **"Execute"**

##### Atualizar Usu√°rio (PATCH /users/{id})

1. Clique em **"PATCH /users/{id}"**
2. Clique em **"Try it out"**
3. Digite o ID do usu√°rio
4. Preencha os campos que deseja atualizar
5. Clique em **"Execute"**

##### Deletar Usu√°rio (DELETE /users/{id})

1. Clique em **"DELETE /users/{id}"**
2. Clique em **"Try it out"**
3. Digite o ID do usu√°rio
4. Clique em **"Execute"**

#### 3. Testar via cURL (Linha de Comando)

```bash
# Teste de sa√∫de
curl http://localhost:3001/health

# Criar usu√°rio
curl -X POST http://localhost:3001/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Maria Silva","gender":"female","email":"maria@email.com","birthDate":"1985-08-20","placeOfBirth":"Rio de Janeiro, RJ","nationality":"Brasileira","cpf":"98765432100"}'

# Listar usu√°rios
curl http://localhost:3001/users

# Buscar por ID
curl http://localhost:3001/users/{id}

# Atualizar usu√°rio
curl -X PATCH http://localhost:3001/users/{id} \
  -H "Content-Type: application/json" \
  -d '{"name":"Maria Silva Atualizada"}'

# Deletar usu√°rio
curl -X DELETE http://localhost:3001/users/{id}
```

#### 4. Recursos da Documenta√ß√£o Swagger

-   ‚úÖ **Interface Interativa**: Teste endpoints diretamente no navegador
-   ‚úÖ **Exemplos de Dados**: Valores de exemplo para todos os campos
-   ‚úÖ **Valida√ß√£o em Tempo Real**: Valida√ß√£o de formul√°rios
-   ‚úÖ **Respostas de Erro**: Documenta√ß√£o de todos os c√≥digos de erro
-   ‚úÖ **Esquemas de Dados**: Estrutura completa dos objetos
-   ‚úÖ **Descri√ß√µes em Portugu√™s**: Documenta√ß√£o localizada

### Schema do Banco de Dados

O modelo User inclui:

-   `id` (UUID, chave prim√°ria)
-   `name` (obrigat√≥rio)
-   `gender` (opcional)
-   `email` (opcional, √∫nico)
-   `birthDate` (obrigat√≥rio)
-   `placeOfBirth` (opcional)
-   `nationality` (opcional)
-   `cpf` (obrigat√≥rio, √∫nico)
-   `createdAt` (gerado automaticamente)
-   `updatedAt` (gerado automaticamente)

## Desenvolvimento

### Desenvolvimento Frontend

-   O frontend usa o hook `useUsers` para todas as opera√ß√µes da API
-   Notifica√ß√µes toast fornecem feedback do usu√°rio para todas as opera√ß√µes CRUD
-   Valida√ß√£o de formul√°rios garante integridade dos dados
-   Tratamento de erros com mensagens amig√°veis ao usu√°rio

### Desenvolvimento Backend

-   M√≥dulos NestJS para arquitetura limpa
-   Prisma para opera√ß√µes de banco de dados
-   Valida√ß√£o de DTO com class-validator
-   Tratamento adequado de erros e c√≥digos de status HTTP

## Testes Automatizados

### Executando os Testes

```bash
# Navegue at√© o diret√≥rio backend
cd backend/

# Executar todos os testes
yarn test

# Executar testes com cobertura de c√≥digo
yarn test:cov

# Executar testes em modo watch (desenvolvimento)
yarn test:watch
```

### Cobertura de Testes

O projeto mant√©m uma cobertura de testes robusta:

-   **Statements**: 91.01% ‚úÖ
-   **Functions**: 90% ‚úÖ
-   **Lines**: 91.46% ‚úÖ
-   **Branches**: 64.91% ‚úÖ

### Testes Implementados

#### Backend (Jest + NestJS Testing)

1. **UserService** - Testes abrangentes para:

    - Cria√ß√£o de usu√°rios (com e sem campos opcionais)
    - Listagem de usu√°rios
    - Busca por ID
    - Atualiza√ß√£o de usu√°rios
    - Remo√ß√£o de usu√°rios
    - Valida√ß√£o de email
    - Tratamento de erros (CPF duplicado, usu√°rio n√£o encontrado, erros de banco)

2. **UserController** - Testes para:

    - Todos os endpoints CRUD
    - Tratamento de erros HTTP
    - Respostas padronizadas
    - Valida√ß√£o de status codes

3. **AppController** e **AppService** - Testes b√°sicos

4. **CreateUserDto** - Testes de valida√ß√£o:

    - Campos obrigat√≥rios
    - Campos opcionais
    - Valida√ß√£o de CPF
    - Valida√ß√£o de data de nascimento

5. **UserModule** - Testes de integra√ß√£o do m√≥dulo

### Estrutura dos Testes

```
backend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.service.spec.ts      # Testes do UserService
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.controller.spec.ts   # Testes do UserController
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.module.spec.ts       # Testes de integra√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ create-user.dto.spec.ts # Testes de valida√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ app.controller.spec.ts         # Testes do AppController
‚îÇ   ‚îî‚îÄ‚îÄ app.service.spec.ts           # Testes do AppService
```

## Solu√ß√£o de Problemas

1. **Problemas de conex√£o com banco de dados:**

    - Certifique-se de que o Docker est√° rodando
    - Verifique se o container PostgreSQL est√° saud√°vel: `docker-compose ps`
    - Aguarde o PostgreSQL estar pronto: `docker-compose logs postgres`

2. **Frontend n√£o consegue conectar ao backend:**

    - Verifique se o backend est√° rodando na porta 3001
    - Verifique a configura√ß√£o CORS no backend
    - Certifique-se de que API_BASE_URL no frontend corresponde √† URL do backend

3. **Conflitos de porta:**

    - Backend roda na porta 3001
    - Frontend roda na porta 5173
    - PostgreSQL roda na porta 5432

4. **Erros de valida√ß√£o de formul√°rio:**

    - Verifique se todos os campos obrigat√≥rios est√£o preenchidos
    - Verifique o formato do email se fornecido
    - Certifique-se de que o CPF tem exatamente 11 d√≠gitos

5. **Problemas com testes:**

    - Certifique-se de estar no diret√≥rio `backend/`
    - Execute `yarn install` se as depend√™ncias n√£o estiverem instaladas
    - Verifique se o Jest est√° configurado corretamente no `package.json`

6. **Problemas com arquivos .env:**

    - Certifique-se de que os arquivos `.env` foram criados em ambos os diret√≥rios (`backend/` e `frontend/`)
    - Verifique se o `DATABASE_URL` no backend est√° correto
    - Confirme se o `VITE_API_URL` no frontend aponta para a porta correta do backend (3001)
    - Reinicie os servi√ßos ap√≥s criar/modificar os arquivos `.env`

7. **Problemas de configura√ß√£o do backend:**

    - O backend usa `@nestjs/config` para carregar vari√°veis de ambiente
    - Certifique-se de que o `ConfigModule` est√° configurado no `app.module.ts`
    - Se as vari√°veis n√£o est√£o sendo carregadas, verifique se o arquivo `.env` est√° no diret√≥rio correto (`backend/.env`)
    - Execute `yarn install` para garantir que `@nestjs/config` est√° instalado

8. **Erro "Command not found" ao executar yarn start:dev:**
    - Certifique-se de estar no diret√≥rio correto: `cd backend/` antes de executar `yarn start:dev`
    - Certifique-se de estar no diret√≥rio correto: `cd frontend/` antes de executar `yarn dev`
    - Verifique se voc√™ est√° no diret√≥rio raiz (`stefanini`) quando executar `docker-compose up postgres -d`
    - Os comandos `yarn start:dev` e `yarn dev` s√≥ funcionam dentro de seus respectivos diret√≥rios

## Estrutura do Projeto

```
‚îú‚îÄ‚îÄ frontend/                 # Frontend React (porta 5173)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/          # Hooks personalizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/          # Tipos TypeScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/          # Fun√ß√µes utilit√°rias
‚îÇ   ‚îú‚îÄ‚îÄ .env.example        # Template de vari√°veis de ambiente
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ backend/                 # Backend NestJS (porta 3001)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/           # M√≥dulo de usu√°rio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ *.spec.ts   # Testes automatizados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ prisma/         # Schema do banco de dados
‚îÇ   ‚îú‚îÄ‚îÄ .env.example        # Template de vari√°veis de ambiente
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ docker-compose.yml      # Configura√ß√£o PostgreSQL (porta 5432)
```

## Resumo

-   ‚úÖ **PostgreSQL**: Rodando no Docker na porta 5432
-   ‚úÖ **Backend**: Rodando localmente na porta 3001
-   ‚úÖ **Frontend**: Rodando localmente na porta 5173
-   ‚úÖ **Aplica√ß√£o**: Acess√≠vel em `http://localhost:5173`
-   ‚úÖ **Testes**: Cobertura de 91%+ com Jest
